"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])}return i},writable:!0,configurable:!0}),function(e){var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(){this._events={},this._conf&&n.call(this,this._conf)}function n(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function r(e){this._events={},this.newListener=!1,n.call(this,e)}function s(e,t,i,n){if(!i)return[];var r,o,a,c,l,d,p,h=[],u=t.length,f=t[n],m=t[n+1];if(n===u&&i._listeners){if("function"==typeof i._listeners)return e&&e.push(i._listeners),[i];for(r=0,o=i._listeners.length;r<o;r++)e&&e.push(i._listeners[r]);return[i]}if("*"===f||"**"===f||i[f]){if("*"===f){for(a in i)"_listeners"!==a&&i.hasOwnProperty(a)&&(h=h.concat(s(e,t,i[a],n+1)));return h}if("**"===f){for(a in(p=n+1===u||n+2===u&&"*"===m)&&i._listeners&&(h=h.concat(s(e,t,i,u))),i)"_listeners"!==a&&i.hasOwnProperty(a)&&("*"===a||"**"===a?(i[a]._listeners&&!p&&(h=h.concat(s(e,t,i[a],u))),h=h.concat(s(e,t,i[a],n))):h=a===m?h.concat(s(e,t,i[a],n+2)):h.concat(s(e,t,i[a],n)));return h}h=h.concat(s(e,t,i[f],n+1))}if((c=i["*"])&&s(e,t,c,n+1),l=i["**"])if(n<u)for(a in l._listeners&&s(e,t,l,u),l)"_listeners"!==a&&l.hasOwnProperty(a)&&(a===m?s(e,t,l[a],n+2):a===f?s(e,t,l[a],n+1):((d={})[a]=l[a],s(e,t,{"**":d},n+1)));else l._listeners?s(e,t,l,u):l["*"]&&l["*"]._listeners&&s(e,t,l["*"],u);return h}function o(e,i){for(var n=0,r=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;n+1<r;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var s=this.listenerTree,o=e.shift();o;){if(s[o]||(s[o]={}),s=s[o],0===e.length){if(s._listeners){if("function"==typeof s._listeners)s._listeners=[s._listeners,i];else if(t(s._listeners)&&(s._listeners.push(i),!s._listeners.warned)){var a=10;void 0!==this._events.maxListeners&&(a=this._events.maxListeners),a>0&&s._listeners.length>a&&(s._listeners.warned=!0)}}else s._listeners=i;return!0}o=e.shift()}return!0}r.prototype.delimiter=".",r.prototype.setMaxListeners=function(e){this._events||i.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},r.prototype.event="",r.prototype.once=function(e,t){return this.many(e,1,t),this},r.prototype.many=function(e,t,i){var n=this;if("function"!=typeof i)throw new Error("many only accepts instances of Function");function r(){0==--t&&n.off(e,r),i.apply(this,arguments)}return r._origin=i,this.on(e,r),n},r.prototype.emit=function(){this._events||i.call(this);var e,t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var n=arguments.length,r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];for(o=0,n=this._all.length;o<n;o++)this.event=t,this._all[o].apply(this,r)}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(this.wildcard){e=[];var a="string"==typeof t?t.split(this.delimiter):t.slice();s.call(this,e,a,this.listenerTree,0)}else e=this._events[t];if("function"==typeof e){if(this.event=t,1===arguments.length)e.call(this);else if(arguments.length>1)switch(arguments.length){case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];e.apply(this,r)}return!0}if(e){for(n=arguments.length,r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];var c=e.slice();for(o=0,n=c.length;o<n;o++)this.event=t,c[o].apply(this,r);return c.length>0||!!this._all}return!!this._all},r.prototype.on=function(e,n){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");if(this._events||i.call(this),this.emit("newListener",e,n),this.wildcard)return o.call(this,e,n),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],n];else if(t(this._events[e])&&(this._events[e].push(n),!this._events[e].warned)){var r=10;void 0!==this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[e].length>r&&(this._events[e].warned=!0)}}else this._events[e]=n;return this},r.prototype.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},r.prototype.addListener=r.prototype.on,r.prototype.off=function(e,i){if("function"!=typeof i)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var o="string"==typeof e?e.split(this.delimiter):e.slice();r=s.call(this,null,o,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n})}for(var a=0;a<r.length;a++){var c=r[a];if(n=c._listeners,t(n)){for(var l=-1,d=0,p=n.length;d<p;d++)if(n[d]===i||n[d].listener&&n[d].listener===i||n[d]._origin&&n[d]._origin===i){l=d;break}if(l<0)continue;return this.wildcard?c._listeners.splice(l,1):this._events[e].splice(l,1),0===n.length&&(this.wildcard?delete c._listeners:delete this._events[e]),this}(n===i||n.listener&&n.listener===i||n._origin&&n._origin===i)&&(this.wildcard?delete c._listeners:delete this._events[e])}return this},r.prototype.offAny=function(e){var t,i=0,n=0;if(e&&this._all&&this._all.length>0){for(i=0,n=(t=this._all).length;i<n;i++)if(e===t[i])return t.splice(i,1),this}else this._all=[];return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||i.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),n=s.call(this,null,t,this.listenerTree,0),r=0;r<n.length;r++){var o=n[r];o._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},r.prototype.listeners=function(e){if(this.wildcard){var n=[],r="string"==typeof e?e.split(this.delimiter):e.slice();return s.call(this,n,r,this.listenerTree,0),n}return this._events||i.call(this),this._events[e]||(this._events[e]=[]),t(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define((function(){return r})):"object"==typeof exports?exports.EventEmitter2=r:window.EventEmitter2=r}(),window.Bootstrap={BACKDATA_PARAM:"sexp",errorArguments:[]},function(e){window.onerror=function(){e.errorArguments.push(arguments)}}(Bootstrap),function(e){e.getAllHistoryState=function(){for(var e,t={},i=/\+/g,n=/([^&=]+)=?([^&]*)/g,r=(window.location.search+window.location.hash).substring(1),s=function(e){try{e=decodeURIComponent(e.replace(i," "))}catch(e){}return e};e=n.exec(r);)t[s(e[1])]=s(e[2]);return t},e.getHistoryState=function(t){return e.getAllHistoryState()[t]},e.isWindowsPhone=function(e){return e=e||navigator.userAgent.toLowerCase(),!!/windows phone/.test(e)},e.isOSX=function(e){return e=e||navigator.userAgent.toLowerCase(),!!/mac os x [0-9]/.test(e)},e.isIPadOS=function(t){return t=t||navigator.userAgent.toLowerCase(),e.isOSX(t)&&navigator.maxTouchPoints},e.isIPad=function(t){return t=t||navigator.userAgent.toLowerCase(),!(!e.isIPadOS(t)&&!/ipad/.test(t))},e.isIPhone=function(t){return t=t||navigator.userAgent.toLowerCase(),!(e.isWindowsPhone(t)||!/iphone/.test(t))},e.isIDevice=function(t){return t=t||navigator.userAgent.toLowerCase(),e.isIPad(t)||e.isIPhone(t)||/\Wios\W/.test(t)},e.isIOS8p=function(t){return t=t||navigator.userAgent.toLowerCase(),!(!e.isIDevice(t)||!e.isIPadOS(t)&&!/os (8|9|[1-9][0-9])|os 10_10/.test(t))},e.isFirefox=function(e){return e=e||navigator.userAgent.toLowerCase(),!!/firefox|fxios/.test(e)},e.isBrave=function(t){return t=t||navigator.userAgent.toLowerCase(),!!navigator.brave&&"function"==typeof navigator.brave.isBrave||e.isIOS8p(t)&&e.isFirefox(t)&&/(\d{2}\.){3}\d{2}/.test(t)||/brave chrome/.test(t)},e.isIE=function(e){return e=e||navigator.userAgent.toLowerCase(),!!/msie|trident/.test(e)},e.isDDGTest=function(e){return e=e||navigator.userAgent.toLowerCase(),!!/ddgtest/.test(e)},e.isOnion=function(e){return!!(e=e||window.location.host).match(/\.onion$/i)},e.isDDGApp=function(e,t){return e=e||navigator.userAgent.toLowerCase(),t=t||window.location.search,!!navigator.duckduckgo&&"ios"===navigator.duckduckgo.platform||!(!t||!t.match(/(\&|\?)t\=(ddg_ios|ddg_android)/))||/DuckDuckGo\/[0-9]/i.test(e)},e.hostRegion=void 0,e.isMobile=void 0,e.isDesktop=void 0,e.isExtensionInstalled=function(){return"duckduckgo"in navigator&&"extension"===navigator.duckduckgo.platform},e.isExtensionInstalledLegacy=function(t,i){var n;if(t=t||navigator.userAgent.toLowerCase(),i=i||window.location.search,document.body){var r=document.createElement("div");r.className="ddg-extension-check ddg-extension-hide",document.body.appendChild(r),n="none"===window.getComputedStyle(r).display,document.body.removeChild(r)}else document.documentElement.classList.add("ddg-extension-check","ddg-extension-hide"),n="none"===window.getComputedStyle(document.documentElement).display,document.documentElement.classList.remove("ddg-extension-check","ddg-extension-hide");return n&&!e.isDDGApp(t,i)},e.PRODUCTS_META_PRODUCT_ADS={region:{"us-en":!0,"uk-en":!0,"ca-en":!0,"fr-fr":!0,"de-de":!0,"in-en":!0,"au-en":!0,"at-de":!0,"es-es":!0,"wt-wt":!0},country:{US:!0,DE:!0,FR:!0,GB:!0,IN:!0,AU:!0,AT:!0,ES:!0}},e.PRODUCTS_META_PRODUCT_ADS_NEW_MARKETS_EXPERIMENT={region:{"ie-en":!0,"dk-da":!0,"ch-de":!0,"ch-fr":!0,"fi-fi":!0,"it-it":!0,"nl-nl":!0,"no-no":!0,"se-sv":!0},country:{IE:!0,DK:!0,CH:!0,FI:!0,IT:!0,NL:!0,NO:!0,SE:!0}},e.AUTOADS_MARKET={region:{"us-en":!0,"uk-en":!0},country:{US:!0,GB:!0}},e.DEFERRED_VERTICALS=["images","videos","news","maps_expanded","products","shopping"],e._region=void 0,e.getRegion=function(){if(null!=window.kl)return window.kl;if(e._region)return e._region;for(var t=document.cookie.split(";"),i=0;i<t.length;i++){var n=t[i].split("=");if(2===n.length){var r=n[0].trim(),s=n[1].trim();if("l"===r&&!/<|>|\//g.test(s))return s}}return""},e.isProductAdsMarket=function(t){var i,n,r=e.getRegion();t&&"b"===t.getExperimentGroup("panexp")?(i=Object.assign(e.PRODUCTS_META_PRODUCT_ADS.country,e.PRODUCTS_META_PRODUCT_ADS_NEW_MARKETS_EXPERIMENT.country),n=Object.assign(e.PRODUCTS_META_PRODUCT_ADS.region,e.PRODUCTS_META_PRODUCT_ADS_NEW_MARKETS_EXPERIMENT.region)):(i=e.PRODUCTS_META_PRODUCT_ADS.country,n=e.PRODUCTS_META_PRODUCT_ADS.region);var s=r&&"wt-wt"!==r;return!(""!==r&&"wt-wt"!==r||!i[window.ct])||!(!s||!n[r])},e.isAutoAdsMarket=function(t){if(!t||"b"!==t.getExperimentGroup("atadexp"))return!1;var i=e.getRegion(),n=i&&"wt-wt"!==i;return!(""!==i&&"wt-wt"!==i||!e.AUTOADS_MARKET.country[window.ct])||!(!n||!e.AUTOADS_MARKET.region[i])},e.validateRequery=function(e){return["images","videos","news","maps","shopping"].indexOf(e)<0?null:e},e.TIMEOUT_DEEP_REQUEST=4e3,e.TIMEOUT_PRELOADED_DEEP_REQUEST=4750,e.shouldDeferDeep=function(t){var i=e.getAllHistoryState(),n=i.ia||!1,r=t?t(i.iar):i.iar,s=i.iax||!1,o=i.iaxm||!1,a=1===window.shfl;return"maps"===o||!!r&&"web"!==r||!!n&&(n===r&&"news"===n||n===s&&"news"!==s)&&e.DEFERRED_VERTICALS.indexOf(n)>-1&&!("shopping"===n&&n===s&&!a)},e.addFrontendQsToBackendDeepUrl=function(t,i,n){var r=(n=n||{}).ua,s=n.search,o=n.skipLinksService,a=i.addExperimentParameters(t)+"&wrap=1";return(e.isExtensionInstalled()||e.isExtensionInstalledLegacy(r,s))&&(a+="&ext=1"),e.isProductAdsMarket(i)&&(a+="&bpa=1"),e.isAutoAdsMarket(i)&&(a+="&baa=1"),e.isBrave(r)&&(a+="&br=brave"),o?a:e.getLinksURL(a)},e.getLinksURL=function(t,i){i=i||window.location.host;return/^staging\./.test(i)?"//staging-links.duckduckgo.com"+t:e.isDev?"//"+i+"/links"+t:"//links.duckduckgo.com"+t}}(Bootstrap),function(e){function t(e){return((e||{}).state||{}).backData||{}}e.BackData=function(e,i){this._searchExperimentsKey=i||"sexp",this._history=e||window.history,this._data=t(this._history),this.ready=!1,this.isLoadedFromBfCache=null,this.timeLoadedFromBfCache=null,this._boundHandlePageShow=this._handlePageShow.bind(this),window.addEventListener("pageshow",this._boundHandlePageShow)},e.BackData.prototype=Object.assign({},EventEmitter2.prototype,{destroy:function(){window.removeEventListener("pageshow",this._boundHandlePageShow),this.removeAllListeners()},_handlePageShow:function(e){if(this._data=t(this._history),e&&e.persisted?(this.isLoadedFromBfCache=!0,this.timeLoadedFromBfCache=Date.now()):(this.isLoadedFromBfCache=!1,this.timeLoadedFromBfCache=null),this._history&&this._history.replaceState&&this._history.state){var i={isSerpReturn:!0};this._history.state.backData&&this._history.state.backData.data&&this._history.state.backData.data[this._searchExperimentsKey]&&(i.data={},i.data[this._searchExperimentsKey]=this._history.state.backData.data[this._searchExperimentsKey]),this._history.replaceState(Object.assign({},this._history.state,{backData:i}),"")}this.ready=!0,this.emit("ready",this.ready)},set:function(e,i,n){i&&i.timestamp&&delete(i=Object.assign({},i)).timestamp,n=Object.assign({isBounceSignal:!0},n),this._history&&this._history.replaceState&&this._history.replaceState(Object.assign({},this._history.state,{backData:{id:e,data:i,isSerpReturn:t(this._history).isSerpReturn,isBounceSignal:!!n.isBounceSignal}}),"")},getId:function(){return this._data.id},getData:function(){return this._data.data||{}},isBounceBack:function(){return!!this._data.isBounceSignal},isSerpReturn:function(){return!!this._data.isSerpReturn}})}(Bootstrap),window.Bootstrap.SearchExperimentsData=[{allocation:1,groups:["b"],parameter:"biaexp",description:"Limit Bing IA slotting for navigational queries",services:["deep"],postEnrollment:function(){if(!window.Bootstrap.getHistoryState("biaexp")){var e=Math.random();e<.475?window.Bootstrap.searchExperiments.biaexp.setGroup("a"):e<.95?window.Bootstrap.searchExperiments.biaexp.setGroup("b"):window.Bootstrap.searchExperiments.biaexp.setGroup("c")}}},{allocation:1,groups:["b"],parameter:"msvrtexp",description:"Bing bridge",services:["deep"],filter:function(){if(!window.Bootstrap||window.Bootstrap.isOnion()||!window.Bootstrap.hostRegion)return!1;var e=Math.random();if(-1!==["brs"].indexOf(window.Bootstrap.hostRegion))return!0;if(-1!==["eun","euw"].indexOf(window.Bootstrap.hostRegion)){if(e<=1)return!0}else if(-1!==["use","usc","usw"].indexOf(window.Bootstrap.hostRegion)){if(e<=1)return!0}else if(-1!==["ase","aue","inw"].indexOf(window.Bootstrap.hostRegion)&&e<=1)return!0;return!1}},{allocation:1,groups:["b"],parameter:"ama5exp",description:"Amazon PA-API v5 engagement/conversion measurement",services:["products"],filter:function(){return"US"===window.ct||"DE"===window.ct}},{allocation:0,groups:["a","b","e"],parameter:"rspexp2",description:"Revisit SERP Spelling Message",services:["deep"]},{allocation:.05,groups:["a"],parameter:"videxp",description:"Exclude 5% of requests from video exclusion logic, so that we have a data set to use when retraining the video engagement prediction model",services:["deep"]},{allocation:0,groups:["a","b","c","d"],parameter:"adlexp",description:"ad load experiment",services:["deep"],filter:function(){return"US"===window.ct&&window.Bootstrap&&window.Bootstrap.isDesktop}},{allocation:0,groups:["x","y","z"],parameter:"uxexp",assignment:"manual",description:"SERP UX Experiments - Testing Allocation Method"},{allocation:0,groups:["a","b","c"],parameter:"tqcls",description:"Technical Queries Classifier: Disable PAs",services:["deep","products"],filter:function(){return"US"===window.ct||"GB"===window.ct||"AU"===window.ct||("CA"===window.ct||"DE"===window.ct||"FR"===window.ct||"IN"===window.ct)&&"en"===window.dl}},{allocation:0,groups:["a","b"],parameter:"qfcls",description:"Quick Fix Queries Classifier: Disable PAs",services:["deep","products"],filter:function(){return"US"===window.ct||"GB"===window.ct||"AU"===window.ct||("CA"===window.ct||"DE"===window.ct||"FR"===window.ct||"IN"===window.ct)&&"en"===window.dl}},{allocation:1,groups:["a","b"],parameter:"eclsexp",description:"Engagement based Queries Classifier: Disable PAs",services:["deep","products"],filter:function(){return"GB"===window.ct||"AU"===window.ct||("CA"===window.ct||"DE"===window.ct||"FR"===window.ct||"IN"===window.ct)&&"en"===window.dl},postEnrollment:function(){Math.random()<.2?window.Bootstrap.searchExperiments.eclsexp.setGroup("a"):window.Bootstrap.searchExperiments.eclsexp.setGroup("b")}},{allocation:.15,groups:["a","b","c"],parameter:"declsexp",description:"Desktop - US - Engagement based Queries Classifier: Disable PAs",services:["deep","products"],filter:function(){return"US"===window.ct&&window.Bootstrap.isDesktop}},{allocation:.2,groups:["a","b","c","d"],parameter:"meclsexp",description:"Mobile - US - Engagement based Queries Classifier: Disable PAs",services:["deep","products"],filter:function(){return"US"===window.ct&&window.Bootstrap.isMobile}},{allocation:1,groups:["a","b"],parameter:"atadexp",description:"Revenue Experiment: Auto Ads",services:["deep"],filter:function(){var e=window.Bootstrap.searchExperiments,t=e&&e.eclsexp&&"b"===e.eclsexp.activeGroup,i=e&&e.declsexp&&e.declsexp.active;return("US"===window.ct||"GB"===window.ct)&&window.Bootstrap.isDesktop&&!i&&!t},postEnrollment:function(){"US"===window.ct&&window.Bootstrap.searchExperiments.atadexp.setGroup("b")}},{allocation:0,groups:["a","b"],parameter:"related_click",description:"Explore By Items click",services:["deep","products"]},{allocation:0,groups:["a","b"],parameter:"related_requery",description:"Explore By Items re-query",services:["deep","products"]},{allocation:0,groups:["a","b"],parameter:"related_done",description:"Explore By Items done",services:["deep","products"]},{allocation:0,groups:["a","b"],parameter:"related",description:"Explore By Items experiment in Shopping Vertical",services:["deep","products"],filter:function(){var e=0===Object.keys(window.Bootstrap.searchExperiments).filter((function(e){return-1!==e.indexOf("related")&&window.Bootstrap.searchExperiments[e].active})).length;return window.Bootstrap.isDesktop&&1===window.shfl&&e}},{allocation:0,groups:["a","b","c","d"],parameter:"msnexp",description:"MSN -site filter and news from organics experiment in News Carousel - Search Experiment",services:["deep","news"],filter:function(){return"US"===window.ct||"us-en"===window.Bootstrap.getRegion()}},{allocation:.3,groups:["a","b","c"],parameter:"lqexp",description:"Experiment with rewriting local queries to include the city name",services:["deep"]},{allocation:0,groups:["e","f"],parameter:"dexp2",description:"Early deep experiment v2"},{allocation:0,groups:["a","b","c","d","e"],parameter:"adxexp",description:"Ad Decorator Experiment Batch A",services:["deep"],filter:function(){return"US"===window.ct}},{allocation:0,groups:["a","b"],parameter:"panexp",description:"New Product Ad Markets Experiment",services:["deep","products"],filter:function(){if("shopping"===window.Bootstrap.getHistoryState("iar")||"shopping"===window.Bootstrap.getHistoryState("iax"))return!1;var e=window.Bootstrap.PRODUCTS_META_PRODUCT_ADS_NEW_MARKETS_EXPERIMENT,t=e&&e.region[window.rl],i=e&&e.country[window.ct];return!(!t&&!i)}},{allocation:0,groups:["a","b"],parameter:"cmtaexp",description:"Experiment to test new Crossmatcher logic for TripAdvisor",services:["deep","local"]}],function(e){e.SearchExperiment=function(t){t=t||{},this.allocation=t.allocation,this.groups=t.groups,this.parameter=t.parameter,this.services=t.services,this.filter=t.filter,this.assignment=t.assignment||"automatic",this.postEnrollment=t.postEnrollment,this.active=!1,this.activeGroup=null,this.activeFromBackButton=!1,this.urlParam="",this.rolledDice=!1,this._isBackendOverridden=!!(t.isDexp2Treatment||t.isDexp2Control&&"dexp2"===t.parameter),!this._isBackendOverridden&&"dexp2"!==this.parameter&&t.backButtonGroup&&this.hasValidGroup(t.backButtonGroup)&&(this.activeFromBackButton=!0,this.setGroup(t.backButtonGroup)),(!this.hasServices()||this.hasServices()&&this._isBackendOverridden)&&!this.isManuallyAssigned()&&(!e.backData.getId()||e.backData.getId()&&this._isBackendOverridden)&&this.rollDice()},e.SearchExperiment.prototype={isManuallyAssigned:function(){return"manual"===this.assignment},hasServices:function(){return this.services&&this.services.length},setGroup:function(e){this.hasValidGroup(e)&&(this.active=!0,this.activeGroup=e,this.urlParam=this.parameter+"="+this.activeGroup)},hasValidGroup:function(e){return-1!==this.groups.indexOf(e)},canRollDice:function(){return!this.rolledDice&&(!this.activeFromBackButton||this.activeFromBackButton&&this._isBackendOverridden)&&(!this.filter||this.filter&&(this._isBackendOverridden||this.filter()))&&!e.isDDGTest()},rollDice:function(){var t,i=this.canRollDice();if(this.rolledDice=!0,!i)return!1;var n=e.getHistoryState(this.parameter);if(this._isBackendOverridden)this.parameter&&this.parameter in window.backendExperimentAssignments&&(t=window.backendExperimentAssignments[this.parameter]);else if(n)t=n;else{var r=Math.random();if(!(r<=this.allocation))return!1;var s=this.allocation/this.groups.length,o=Math.floor(r/s);t=this.groups[o]}return!!t&&(this.setGroup(t),this.postEnrollment&&!this._isBackendOverridden&&this.postEnrollment(),!0)}}}(Bootstrap),function(e){var t={deep:["d.js","t.js"],local:["local.js","spice/maps/places","spice/maps/maps"],news:["news.js","spice/news"],images:["i.js","spice/images"],videos:["v.js","spice/videos"],products:["m.js","spice/amazon"],embed:["f.js"],nlp:["a.js"]},i=/^\/?((?:d|t|local|news|i|v|m|f|a).js)|\/js\/(spice\/.*)\//;e.SearchExperiments=function(){this._isDexp2Control=window.backendExperimentAssignments&&"e"===window.backendExperimentAssignments.dexp2,this._isDexp2Treatment=window.backendExperimentAssignments&&"f"===window.backendExperimentAssignments.dexp2;var t=e.backData.getData()[e.BACKDATA_PARAM]||{};this.experiments=e.SearchExperimentsData.map(function(i){var n=new e.SearchExperiment(Object.assign({backButtonGroup:t[i.parameter],isDexp2Control:this._isDexp2Control,isDexp2Treatment:this._isDexp2Treatment},i));return this[n.parameter]=n,n}.bind(this))},e.SearchExperiments.BACKDATA_PARAM=e.BACKDATA_PARAM,e.SearchExperiments.prototype={assign:function(t){var i=this[t],n=!!(this._isDexp2Treatment||this._isDexp2Control&&"dexp2"===t);if((!e.backData.getId()||n)&&i&&i.isManuallyAssigned())return i.rollDice()?(this._clearCache(),i.activeGroup):void 0},getExperimentGroup:function(e){return this[e]&&this[e].activeGroup},addExperimentParameters:function(t){var n=t.match(i),r=n&&(n[1]||n[2]);if(!r)return t;var s=this._getServiceForURLFragment(r),o=s&&this._getExperimentsForService(s),a=!!e.backData.getId(),c=[];if(!o)return t;if(o.forEach(function(e){var t=!!(this._isDexp2Treatment||this._isDexp2Control&&"dexp2"===e.parameter);(!a||a&&t)&&e.rollDice()&&this._clearCache(),e.active&&c.push(e.urlParam)}.bind(this)),c.length){var l=-1==t.indexOf("?")?"?":"&";t+=l+c.join("&")}return t},getPixelParameters:function(){if(void 0!==this._pixelParams)return this._pixelParams;var e=window.backendExperimentAssignments&&window.backendExperimentAssignments.dexp2;return this._pixelParams=this.getActiveExperiments().map((function(e){return e.urlParam})).concat(null!=e?["backend_dexp2="+e]:[]).join("&")},getBackButtonData:function(){var e={};return this.getActiveExperiments().forEach((function(t){e[t.parameter]=t.activeGroup})),e},hasActiveExperiments:function(){return!!this.getActiveExperiments().length},getActiveExperiments:function(){return this._activeExperiments?this._activeExperiments:this._activeExperiments=this.experiments.filter((function(e){return e.active}))},_getExperimentsForService:function(e){return this._experimentsForService||(this._experimentsForService={},this.experiments.forEach(function(e){e.hasServices()&&e.services.forEach(function(t){this._experimentsForService[t]||(this._experimentsForService[t]=[]),this._experimentsForService[t].push(e)}.bind(this))}.bind(this))),this._experimentsForService[e]||[]},_getServiceForURLFragment:function(e){if(!this._serviceForURLFragment)for(var i in this._serviceForURLFragment={},t)for(var n=t[i],r=0;r<n.length;r++)this._serviceForURLFragment[n[r]]=i;return this._serviceForURLFragment[e]},_clearCache:function(){delete this._pixelParams,delete this._activeExperiments}}}(Bootstrap),function(e){e.DeepPreloader=function(){this.status="idle",this.startFetchTime=null,this.endFetchTime=null,this._onLoad=null,this._onError=null,this._onTimeout=null},e.DeepPreloader.prototype.fetch=function(e,t){this.startFetchTime=Date.now(),this.endFetchTime=null,this.status="pending";var i=document.createElement("script"),n=document.createElement("link");n.rel="preload",n.as="script",n.href=e,document.head.appendChild(n);var r=function(){this._onLoad=null,this._onError=null,this._onTimeout=null,i&&(i.onload=null,i.onerror=null,document.head.removeChild(i),i=null),n&&(document.head.removeChild(n),n=null)}.bind(this);if(t>0)var s=setTimeout(function(){this.status="timeout",this._onTimeout&&this._onTimeout(),r()}.bind(this),t);i.onload=function(){clearTimeout(s),this.endFetchTime=Date.now();var e=this.endFetchTime-this.startFetchTime;"timeout"!==this.status&&(this.status="success",this._onLoad&&this._onLoad(e)),r()}.bind(this),i.onerror=function(){clearTimeout(s),this.endFetchTime=Date.now();var e=this.endFetchTime-this.startFetchTime;"timeout"!==this.status&&(this.status="error",this._onError&&this._onError(e)),r()}.bind(this),i.src=e,document.head.appendChild(i)},e.DeepPreloader.prototype.addEventListener=function(e,t){switch(e){case"load":this._onLoad=t;break;case"error":this._onError=t;break;case"timeout":this._onTimeout=t}}}(Bootstrap),function(e){e.backData=new e.BackData(window.history,e.BACKDATA_PARAM),e.searchExperiments=new e.SearchExperiments}(Bootstrap);